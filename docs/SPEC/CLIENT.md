# プロダクト仕様

## 目次

1. [概要](#概要)
2. [画面仕様および機能仕様](#画面仕様および機能仕様)
   - [apps/webとapps/nativeの共通仕様](#appsweb%E3%81%A8appsnative%E3%81%AE%E5%85%B1%E9%80%9A%E4%BB%95%E6%A7%98)
     - [ページ構成](#ページ構成)
     - [共通機能](#共通機能)
     - [ユーザビリティ](#ユーザビリティ)
     - [アクセシビリティ](#アクセシビリティ)
   - [トップ画面（/）](#トップ画面)
   - [共有ビュー（/lists/[listId]?share=[token]）](#共有ビューlistslistidsharetok)
   - [ユーザー登録画面（/register）](#ユーザー登録画面register)
   - [ログイン画面（/login）](#ログイン画面login)
   - [パスワード忘れ画面（/forgot-password）](#パスワード忘れ画面forgot-password)
   - [パスワードリセット画面（/reset-password）](#パスワードリセット画面reset-password)
   - [設定ページ（/settings）](#設定ページsettings)
   - [認証状態管理](#認証状態管理)
   - [共通UIコンポーネント](#共通uiコンポーネント)
3. [Web技術仕様](#web技術仕様)
4. [Native（iOS/Android）技術仕様](#nativeiosandroid技術仕様)
5. [共同編集機能](#共同編集機能)
   - [概要](#概要-1)
   - [技術仕様](#技術仕様)
   - [APIエンドポイント](#apiエンドポイント)
   - [クライアント実装](#クライアント実装)
   - [パフォーマンス最適化](#パフォーマンス最適化)
   - [エラーハンドリング](#エラーハンドリング)
   - [セキュリティ](#セキュリティ)
6. [制限事項](#制限事項)
7. [今後のロードマップ](#今後のロードマップ)
   - [フェーズ1（次回アップデート）](#フェーズ1次回アップデート)
   - [フェーズ2（中期計画）](#フェーズ2中期計画)
   - [フェーズ3（長期計画）](#フェーズ3長期計画)

## 概要

Lightlistは、マルチプラットフォーム対応のアプリケーションです。
Web、iOS、Androidで動作し、共同編集機能を備えた共有型タスクリスト管理アプリケーションです。

## 画面仕様および機能仕様

### apps/webとapps/nativeの共通仕様

#### ページ構成

- / - アプリ画面
- /register - ユーザー登録画面
- /login - ログイン画面
- /forgot-password - パスワード忘れ画面
- /reset-password - パスワードリセット画面
- /settings - 設定画面
- /tasklistdocs/[listId]?share=[token] - タスクリスト共有ビュー

#### 共通機能

- テーマ対応
  - システムテーマ（デバイスの設定に従う）
  - ライトテーマ（明るいテーマ）
  - ダークテーマ（暗いテーマ）
- 多言語対応（日本語/英語）
- レスポンシブデザイン
  - PC・タブレット: サイドバー＋メインコンテンツ
  - モバイル: ドロワーメニュー＋メインコンテンツ
- アクセシビリティを考慮する

#### ユーザビリティ

- エラー回復機能
  - 削除操作の取り消し機能（5秒間のUndo表示）
    - トースト通知形式（画面下部）
    - 「元に戻す」ボタンと「×」閉じるボタン
    - 個別タスクの削除は実装しない（完了で十分）
  - 編集中の内容の自動保存とリカバリー
  - ネットワークエラー時の自動リトライ（最大3回）
  - 操作フィードバック: 成功・エラー時のトースト通知（react-hot-toast使用）
- オフライン対応
  - オフライン時の操作をキューに保存
  - オンライン復帰時に自動同期
  - オフライン状態の表示は不要（シームレスな体験を提供）
  - オフライン時でも全機能が利用可能（ローカルストレージを活用）
  - オンライン復帰時の競合解決メカニズム
- キーボードショートカット
  - `Ctrl/Cmd + N`: 新しいタスク追加（タスク入力フィールドにフォーカス）
  - `Ctrl/Cmd + Enter`: タスク保存（編集モード時のみ）
  - `Delete`: 選択したタスクの削除
  - `Ctrl/Cmd + /`: ショートカット一覧表示
  - `左矢印`: 前のタスクリストに移動
  - `右矢印`: 次のタスクリストに移動
  - `Escape`: 編集モードのキャンセル、モーダルを閉じる
  - `F2`: タスクの編集モード開始
  - `Space`: チェックボックスのトグル（タスク完了/未完了切り替え）
  - `Alt + 上下矢印`: タスクの手動並び替え（ドラッグ&ドロップの代替操作）
- フォーカス管理
  - 論理的なタブ順序の設定
  - フォーカストラップ（モーダル内）
  - 視認性の高いフォーカスインジケーター（2px以上のアウトライン）

#### アクセシビリティ

- 色覚対応
  - 色のみに依存しない情報伝達
  - 完了状態：チェックマーク＋取り消し線
  - エラー状態：アイコン＋テキスト説明
  - 重要度：アイコン＋ラベル
- 読み上げ対応
  - 画像・アイコンの代替テキスト
  - フォーム要素の明確なラベル付け
  - エラーメッセージの即時通知
- 操作性
  - タッチターゲット最小サイズ: 44×44px
  - クリック可能領域の十分な余白
  - ドラッグ操作の代替手段提供

### トップ画面（/）

#### ワイヤーフレーム構成

```text
【モバイルレイアウト】
┌─────────────────────────────────┐
│ [≡] Lightlist                  │ <- ヘッダー（モバイルのみ）
├─────────────────────────────────┤
│ タスクリスト名            [i]   │ <- 上部パディング8px
│ ─────────────────────────────── │
│ [+] タスクを入力...        [↑]  │
│ ─────────────────────────────── │
│ ≡ ☐ タスク1              📅    │ <- タスクアイテム（1行目）
│     2025年1月15日               │ <- 日付表示（2行目）
│ ─────────────────────────────── │
│ ≡ ☑ タスク2              📅    │
│ ─────────────────────────────── │
│ ≡ ☐ タスク3              📅    │
│ ─────────────────────────────── │
│                                 │
│ [↕ ソート] [🗑 完了削除] [🔗共有]│ <- 下部固定
│ ─────────────────────────────── │
│ ● ● ○ ○                         │ <- インジケーター
└─────────────────────────────────┘

【PCレイアウト】
┌───────────────┬─────────────────────────────────┐
│               │ タスクリスト名          [i]     │
│  サイドバー   │ ─────────────────────────────── │
│               │ [+] タスクを入力...      [↑]    │
│               │ ─────────────────────────────── │
│               │ （以下同様、余白最小限）         │
└───────────────┴─────────────────────────────────┘
```

#### レイアウト詳細

- ヘッダー（モバイルのみ）
  - 高さ: 48px（情報密度重視）
  - 左: ハンバーガーメニューアイコン（24x24px）
  - 中央: アプリ名「Lightlist」
  - 下部に区切り線

- メインコンテンツ
  - パディング: 8px（モバイル）、16px（デスクトップ）
  - セクション間: 区切り線のみ（余分な余白なし）
  - 背景: 単色（カード風の装飾なし）

- タスクアイテム
  - 高さ: 最小限（コンテンツに応じて可変）
  - パディング: 上下8px、左右12px
  - 1行目の構成:
    - 並び替えハンドル: 20x20px
    - チェックボックス: 18x18px（左マージン8px）
    - タスク名: flex-grow（左マージン8px）
    - 日付ボタン: 28x28px
    - 削除ボタンは不要
  - 2行目（日付設定時のみ）:
    - 左パディング: 46px（ハンドル+チェックボックス分）
    - フォントサイズ: 12px
    - 上マージン: 4px

- アクションボタン
  - 位置: コンテンツ下部（固定ではなくスクロール内）
  - パディング: 上下12px

- ドロワーナビゲーション
  - トリガー: ハンバーガーメニューアイコン（左上配置）
  - モバイルでは画面全体サイズ、PCではサイドバー固定表示
  - サイドバー内容:
    - ユーザ名(ない場合はメールアドレス)と設定アイコン: 設定ページに遷移
    - タスクリストのリスト:
      - 並び替えハンドル
      - タスクリスト名
      - 共有中アイコン（他ユーザーと共有している場合のみ表示）
      - 背景色設定ボタン:
        - カラーピッカーでタスクリストの背景色を選択
        - プリセットカラー（8色程度）から選択可能
        - 選択した色は即座に反映され、自動保存
      - 削除ボタン:
        - タスクリストの削除（Undo対応）
        - 確認ダイアログは表示しない
    - タスクリストの追加ボタン:
      - 新しいタスクリストの作成
      - 入力フィールドをモーダル表示
      - 保存ボタン: タスクリスト名を保存
- メインコンテンツ
  - タスクリストカルーセル
    - 全デバイスで1枚表示
    - ドットインジケーター表示（クリックで移動可能）
    - 横スクロール/スワイプで移動
    - タスクリストの詳細表示:
      - 背景色: サイドバーで設定した色が反映される
      - タスクリスト名: 編集可能
        - ダブルクリックまたはEnterキーで編集モード
        - Escapeキーで編集キャンセル
        - 自動保存（フォーカスアウト時）
      - 情報アイコン: クリックで共有ユーザー一覧モーダル表示
      - 共有ボタン:
        - 共有モーダルを表示
        - Web Share APIが利用可能な場合は使用
        - 共有リンクのコピー機能
      - タスクテキスト入力フィールド: 新しいタスクのテキスト
        - 自然言語日付解析機能: タスクの先頭に日付表現がある場合、自動で日付を設定（日英対応）
          - 日本語パターン:
            - 基本: 「今日」「明日」「明後日」「あさって」
            - 曜日: 「月」「月曜」「月曜日」（次の該当曜日、今日がその曜日なら来週）
            - 相対日付: 「N日後」「来週」「再来週」
            - 月日: 「M/D」「M月D日」（過去の日付は来年に自動設定）
            - 完全日付: 「YYYY/MM/DD」「YYYY-MM-DD」
          - 英語パターン:
            - 基本: 「today」「tomorrow」「day after tomorrow」（大文字小文字不問）
            - 曜日: 「mon」「monday」「tue」「tuesday」など（略称対応）
            - 相対日付: 「in N days」「next week」
            - 月日: 「M/D」「jan 15」「january 15」など（月名対応）
        - 楽観的更新: 入力と同時にUIを更新、エラー時は自動で元に戻す
        - プレースホルダー: 「タスクを入力...」（言語に応じて変更）
        - オートコンプリート: 過去のタスクから候補表示
        - aria-label: 「新しいタスクを入力」
      - タスク追加ボタン:
        - 新しいタスクの追加
        - 設定で、上に追加するか下に追加するかを選択可能(デフォルトは上)
      - タスクのソートボタン:
        - 機能: タスクの並び替え(完了・未完了、日付有無、日付順、その他は作成日時新しい順、の優先度で並び替え)
        - 自動ソート有効時の挙動:
          - ボタンが無効化され、押すことができない
          - ツールチップで「自動並び替えが有効のため手動並び替えは無効です」を表示
          - ボタン下部に「自動並び替えが有効です。タスクは自動的に並び替えられます。」のガイダンス表示
        - ソート中のアニメーション表示
        - ソート完了時の通知（「並び替えが完了しました」）
        - aria-label: 「タスクを並び替え」
      - 完了タスクの削除ボタン:
        - 完了済みタスクを一括削除（Undo対応）
        - 確認ダイアログは表示しない
      - タスクリスト:
        - 並び替えハンドル
          - ドラッグ中の視覚的フィードバック（影、透明度）
          - ドロップ位置のプレビュー表示
          - キーボード操作: Alt + 上下矢印キー
          - aria-label: 「タスクを移動」
          - 手動並び替えは自動ソート無効時のみ可能
          - 並び替え結果はサーバーに自動保存
        - 完了チェックボックス
          - スペースキーでのトグル対応
          - チェック時のアニメーション
          - aria-label: 「タスクを完了にする」
        - タスク名: 編集可能
          - クリックまたはF2キーで編集モード
          - 編集中の枠線表示
          - 変更時の自動保存インジケーター
        - 日付設定ボタン（日付のみ、時刻なし）
          - カレンダーのキーボード操作対応
          - 今日の日付のハイライト
          - aria-label: 「期限を設定」

#### モーダル仕様

- タスクリスト作成モーダル
  - モーダル開閉時のフォーカス管理
  - Escapeキーでのモーダル閉じる
  - タスクリスト名入力フィールド: 新しいタスクリスト名
    - 自動フォーカス
    - 最大文字数制限（50文字）と残り文字数表示
    - aria-required="true"
  - タスクリスト追加ボタン: 新しいタスクリストの追加
    - 無効化状態の明確な表示（空欄時）
    - 作成中のローディング表示

- 共有モーダル
  - 共有リンクの表示
  - コピーボタン（コピー成功時にアイコン変更）
  - Web Share APIが利用可能な場合:
    - 「共有」ボタンでネイティブ共有UI表示
  - QRコード表示（オプション）
  - 共有をやめるボタン（リンクを無効化）

- 共有ユーザー一覧モーダル
  - タイトル: 「共有中のユーザー」
  - ユーザー一覧:
    - ユーザー名（メールアドレスは非表示）
    - 「あなた」ラベル（自分の場合）
  - 閉じるボタン

- 日付選択モーダル
  - タスク名表示: 対象タスクの確認
  - クイック選択: 「今日」「明日」「期限をクリア」
  - カレンダー: 月間表示、前後月移動、今日ハイライト
  - 選択中の日付表示
  - モーダル開閉時のフォーカス管理
  - Escapeキーでのモーダル閉じる

#### その他

- 未認証状態の場合、ログインページにリダイレクト
- レスポンシブデザイン
  - ブレークポイント: 640px（モバイル）、768px（タブレット）、1024px（デスクトップ） - サイドバー固定表示の境界
  - タッチジェスチャー対応（スワイプ、ピンチズーム）
  - モバイル（1024px未満）: ドロワーメニュー + 履歴API対応（戻るボタンでドロワー閉じる）
  - デスクトップ（1024px以上）: 固定サイドバー（280px幅）+ メインコンテンツ
- パフォーマンス
  - 仮想スクロール（100件以上のタスク表示時）
  - 画像の遅延読み込み
  - Service Workerによるキャッシュ
- ドロワーオープン時には、履歴API（pushState）を使用してブラウザの戻るボタンで閉じれるようにする

### 共有ビュー（/lists/[listId]?share=[token]）

#### ワイヤーフレーム構成

```text
┌─────────────────────────────────┐
│ 〇〇さんのタスクリスト          │ <- 所有者表示
├─────────────────────────────────┤
│ タスクリスト名                  │
│ ─────────────────────────────── │
│ ☐ タスク1（読み取り専用）      │
│    2025年1月15日                │
│ ─────────────────────────────── │
│ ☑ タスク2（読み取り専用）      │
│ ─────────────────────────────── │
│ ☐ タスク3（読み取り専用）      │
│ ─────────────────────────────── │
│                                 │
│ [+ 自分のリストに追加]          │ <- ログイン時のみ
└─────────────────────────────────┘
```

#### アクセス制御

- 未ログインユーザーもアクセス可能（読み取り専用）
- ログインユーザーは「自分のリストに追加」ボタンを表示

#### レイアウト

- 読み取り専用のタスクリスト表示
  - タスクリスト名（編集不可）
  - タスク一覧（チェックボックスは無効化）
  - 背景色の反映
- 「自分のリストに追加」ボタン（ログイン時のみ）
  - クリックで即座に実行（確認ダイアログなし）
  - 同じ名前のタスクリストが既に存在する場合は追加しない
  - 追加成功時: トースト通知「タスクリストを追加しました」
  - 既に追加済みの場合: トースト通知「既に追加されています」
  - どちらの場合もトップ画面へ遷移
  - タスクも含めて全てコピー（完了状態も維持）
- 所有者情報の表示
  - 「〇〇さんのタスクリスト」の形式
  - メールアドレスの@前の部分を所有者名として表示

### ユーザー登録画面（/register）

#### ワイヤーフレーム構成

```text
┌─────────────────────────────────┐
│        [Lightlistロゴ]          │
│                                 │
│        ユーザー登録             │
│  ─────────────────────────────  │
│  メールアドレス                 │
│  [_________________________]    │
│                                 │
│  パスワード                     │
│  [_________________________]    │
│  弱い ━━━━━━━━━━━━━━━━━━━    │
│                                 │
│  パスワード（確認）             │
│  [_________________________]    │
│                                 │
│  [      ユーザー登録      ]     │
│                                 │
│  既にアカウントをお持ちの方は   │
│  ログイン                       │
└─────────────────────────────────┘
```

#### レイアウト詳細

- フォームコンテナ
  - 最大幅: 400px
  - 中央寄せ
  - パディング: 16px（モバイル）、24px（デスクトップ）
  - 背景: 通常背景（影なし）

- ロゴ
  - サイズ: 100x32px
  - 上マージン: 32px
  - 下マージン: 24px

- 入力フィールド
  - 幅: 100%
  - 高さ: 40px
  - ラベルとフィールドの間隔: 4px
  - フィールド間の間隔: 16px

- パスワード強度表示
  - プログレスバー形式
  - 色: 赤（弱い）→ 黄（普通）→ 緑（強い）

### ログイン画面（/login）

#### ワイヤーフレーム構成

```text
┌─────────────────────────────────┐
│                                 │
│        [Lightlistロゴ]          │
│                                 │
│  ┌───────────────────────────┐  │
│  │        ログイン            │  │
│  │  ─────────────────────────  │  │
│  │                            │  │
│  │  メールアドレス            │  │
│  │  [___________________]     │  │
│  │                            │  │
│  │  パスワード                │  │
│  │  [___________________]     │  │
│  │                            │  │
│  │  パスワードを忘れた方は    │  │
│  │  こちら                    │  │
│  │                            │  │
│  │  [      ログイン      ]    │  │
│  │                            │  │
│  │  アカウントをお持ちでない方 │  │
│  │  は ユーザー登録           │  │
│  └───────────────────────────┘  │
│                                 │
└─────────────────────────────────┘
```

#### レイアウト

- 共通レイアウト（登録画面と同じ）
  - 最大幅: 400px
  - 中央寄せ
  - ロゴ配置も同様

### パスワード忘れ画面（/forgot-password）

#### ワイヤーフレーム構成

```text
┌─────────────────────────────────┐
│                                 │
│        [Lightlistロゴ]          │
│                                 │
│  ┌───────────────────────────┐  │
│  │    パスワードリセット      │  │
│  │  ─────────────────────────  │  │
│  │                            │  │
│  │  登録したメールアドレスに   │  │
│  │  パスワードリセットリンクを │  │
│  │  送信します                │  │
│  │                            │  │
│  │  メールアドレス            │  │
│  │  [___________________]     │  │
│  │                            │  │
│  │  [       送信       ]      │  │
│  │                            │  │
│  │  ログイン画面に戻る        │  │
│  └───────────────────────────┘  │
│                                 │
└─────────────────────────────────┘
```

### パスワードリセット画面（/reset-password）

#### ワイヤーフレーム構成

```text
┌─────────────────────────────────┐
│                                 │
│        [Lightlistロゴ]          │
│                                 │
│  ┌───────────────────────────┐  │
│  │   新しいパスワードを設定   │  │
│  │  ─────────────────────────  │  │
│  │                            │  │
│  │  新しいパスワード          │  │
│  │  [___________________]     │  │
│  │  弱い ━━━━━━━━━━━━━━━━   │  │
│  │                            │  │
│  │  パスワード（確認）        │  │
│  │  [___________________]     │  │
│  │                            │  │
│  │  [ パスワードをリセット ]  │  │
│  │                            │  │
│  └───────────────────────────┘  │
│                                 │
└─────────────────────────────────┘
```

#### レイアウト

- ユーザ登録フォーム
  - エラーメッセージ: エラーが発生した場合に表示
  - メールアドレス(必須)
    - type: email
    - バリデーション: RFC準拠のメール形式
    - プレースホルダー: 「メールアドレスを入力」
  - パスワード(必須)
    - type: password
    - プレースホルダー: 「パスワードを入力」
    - 要件: 大文字・小文字・数字を含む
  - パスワード確認(必須)
    - type: password
    - プレースホルダー: 「パスワードを再入力」
    - バリデーション: パスワードとの一致確認
  - 「ユーザー登録」ボタン:
    - 「登録中...」テキスト表示: 送信中のローディング状態表示
  - 「既にアカウントをお持ちの方は ログイン」リンク:
    - ログイン画面へのリンク

#### その他

- フォームバリデーション
  - リアルタイムでの入力検証
  - パスワード不一致時のエラー表示
  - APIエラー時の詳細メッセージ表示
  - メールアドレス: RFC準拠の形式チェック
  - パスワード: 大文字・小文字・数字を含む強度チェック
  - パスワード確認: 入力パスワードとの一致確認
  - パスワード強度表示: 弱い/普通/強いの3段階で視覚的フィードバック
  - SDKのバリデーション機能を活用（@lightlist/sdk）
- 登録処理
  - フォーム送信時にAPIへPOSTリクエスト
  - 成功時:
  - ログイン状態へ遷移しトップ画面へ
  - 初回のタスクリスト作成はクライアント側で実行
  - 設定は初回アクセス時にデフォルト適用
  - 失敗時: エラーメッセージ表示
- 処理フロー
  1. APIへ認証リクエスト送信
  2. 成功時: セッション（Cookie/Bearer）とユーザー情報を受信
  3. クライアント側でセッション維持（Cookie/Bearerのいずれか）
  4. 認証状態を更新
  5. トップ画面へリダイレクト

### パスワード忘れ画面（/forgot-password）

#### レイアウト

- パスワードリセットフォーム
  - 説明文: 「登録したメールアドレスにパスワードリセットリンクを送信します」
  - メールアドレス(必須)
    - type: email
    - バリデーション: RFC準拠のメール形式
    - プレースホルダー: 「メールアドレスを入力」
  - 「送信」ボタン:
    - 「送信中...」テキスト表示: 送信中のローディング状態表示
  - 「ログイン画面に戻る」リンク

#### その他

- セキュリティ: 未登録メールアドレスでも「送信しました」と表示
- 送信後もその画面に留まり、成功メッセージを表示
- 連続送信制限: 5分に1回まで（残り時間を表示）

### パスワードリセット画面（/reset-password）

#### アクセス方法

- メールのリンクから、トークン付きでアクセス
- URL例: /reset-password?token=xxxxxxxx

#### レイアウト

- パスワードリセットフォーム
  - 新しいパスワード(必須)
    - type: password
    - プレースホルダー: 「新しいパスワード」
    - 要件: 大文字・小文字・数字を含む
  - パスワード確認(必須)
    - type: password
    - プレースホルダー: 「新しいパスワードを再入力」
  - 「パスワードをリセット」ボタン:
    - 「リセット中...」テキスト表示

#### その他

- トークン有効期限: 24時間
- リセット成功時: 自動ログインしてトップ画面へ
- 無効/期限切れトークン: /forgot-passwordへリダイレクトし、エラーメッセージ表示

### 設定ページ（/settings）

#### ワイヤーフレーム構成

```text
┌─────────────────────────────────┐
│  [←] 設定                      │
├─────────────────────────────────┤
│ プロフィール                    │
│ ユーザー名                      │
│ [_________________________]     │
│ ─────────────────────────────── │
│ 表示設定                        │
│ テーマ    [システム        ▼]   │
│ 言語      [日本語          ▼]   │
│ ─────────────────────────────── │
│ タスク設定                      │
│ 挿入位置  [上に追加        ▼]   │
│ ☑ 自動並び替え                 │
│ ─────────────────────────────── │
│ アカウント                      │
│ [      ログアウト      ]        │
│ ─────────────────────────────── │
│ [    アカウントを削除    ]      │ <- 赤色のボタン
└─────────────────────────────────┘
```

#### レイアウト詳細

- ヘッダー
  - 高さ: 48px
  - 戻るボタン（矢印アイコン）
  - タイトル「設定」

- セクション構成
  - セクションタイトル: フォントサイズ14px、太字
  - セクション間: 区切り線のみ（余白8px）
  - 入力要素の間隔: 8px
  - 左右パディング: 16px

- 入力フィールド配置
  - ラベルと入力欄を横並び（スペース効率化）
  - ラベル幅: 固定（100px程度）
  - 入力欄: 残り幅を使用

- 危険な操作
  - アカウント削除ボタン: 赤色テキストまたは赤枠

### 共通UIコンポーネント

#### モーダル

```text
┌─────────────────────────────────┐ <- 画面全体に半透明オーバーレイ
│    ┌─────────────────────┐      │
│    │ モーダルタイトル [×]│      │
│    │ ───────────────────  │      │
│    │ コンテンツ部分      │      │
│    │                     │      │
│    │ [キャンセル] [確認] │      │
│    └─────────────────────┘      │
└─────────────────────────────────┘
```

仕様:

- 幅: 最大400px（モバイルは90%）
- パディング: 16px
- 中央配置（垂直・水平）
- 背景オーバーレイ: rgba(0,0,0,0.5)
- Escapeキーで閉じる

#### トースト通知

```text
┌─────────────────────────────────┐
│                                 │
│                                 │
│  ┌───────────────────────────┐  │
│  │ ✓ メッセージ    [元に戻す][×]│  │ <- 画面下部に表示
│  └───────────────────────────┘  │
└─────────────────────────────────┘
```

仕様:

- 位置: 画面下部から20px
- 幅: 最大400px
- 表示時間: 5秒（Undo機能がある場合）
- アニメーション: 下からスライドイン

#### ドロワーメニュー（モバイル）

```text
┌─────────────────────────────────┐
│≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡│ <- 全画面表示
│≡ user@example.com        [⚙] ≡│
│≡─────────────────────────────≡│
│≡ ≡ 📝 個人タスク      🎨 🗑  ≡│
│≡ ≡ 🛒 買い物リスト    🎨 🗑  ≡│
│≡ ≡ 💼 仕事タスク      🎨 🗑  ≡│
│≡─────────────────────────────≡│
│≡ [+ 新しいタスクリスト]      ≡│
│≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡│
└─────────────────────────────────┘
```

仕様:

- 幅: 100%（モバイル）、280px（タブレット以上）
- スライドアニメーション: 左から
- リストアイテム高さ: 44px（タッチターゲット確保）
- パディング: 12px
- ブラウザの戻るボタンで閉じる

#### レイアウト

- ホームに戻るボタン: トップ画面へ戻る
- 設定変更セクション
  - プロフィール設定セクション（認証済みユーザーのみ）
    - ユーザ名編集
      - テキスト入力フィールド: blurで更新
  - テーマ設定セレクトボックス
    - 選択肢
      - システム（デバイスの設定に従う）
      - ライト（明るいテーマ）
      - ダーク（暗いテーマ）
    - 選択と同時に即座に反映
  - 言語設定セレクトボックス:
    - 選択肢:
      - 日本語
      - English
    - 選択と同時にアプリケーション全体の言語が切り替わり
  - タスクの挿入位置セレクトボックス
    - 選択肢:
      - 上に追加（新しいタスクを上部に追加、デフォルト）
      - 下に追加（新しいタスクを下部に追加）
    - 選択と同時に設定が保存され、次回のタスク追加時に反映
  - 自動並び替えチェックボックス:
    - 機能: タスクの並び替え(完了・未完了、日付有無、日付順、そのほかは並び順を維持、の優先度で並び替え)
    - チェック状態で自動並び替えを有効化/無効化
- ログアウトボタン:
  - 機能: ログアウト処理を実行し、トップ画面へリダイレクト
  - 確認ダイアログ表示: 「ログアウトしますか？」
  - ログアウト処理中のローディング表示
- アカウント削除ボタン:
  - 機能: アカウント削除処理を実行し、トップ画面へリダイレクト
  - 確認ダイアログ表示: 「本当にアカウントを削除しますか？この操作は取り消せません」
  - 即座に削除（復元機能なし）

#### その他

- 未認証状態の場合、ログインページにリダイレクト
- アクセシビリティ考慮
  - 各設定項目に適切なラベルとヘルプテキスト
  - 設定変更時の確認メッセージ（スクリーンリーダー対応）
  - キーボードのみでの操作可能
- ログアウト処理フロー
  1. Better Authのログアウトエンドポイントへリクエスト
  2. クライアントの認証状態をクリア
  3. トップ画面を再表示（未認証状態）

### 認証状態管理

- セッション: Better AuthのCookie（またはBearer）で維持
- 保存データ
  - セッション（Cookie/Bearer）
  - ユーザー情報（ID、メールアドレス、ユーザー名）
- セッション復元: ページロード時にlocalStorageなどから認証状態を復元
- JWT連携（better-auth jwt plugin）
  - getSession実行時、fetchOptions.onSuccessでレスポンスヘッダーset-auth-jwtからJWTを取得し、localStorageのauth:jwtに保存
  - signUp/signIn後もgetSessionを呼び出してJWTを同期
  - signOut時はauth:jwtも削除
  - 例:
    - getSession: authClient.getSession({ fetchOptions: { onSuccess: (ctx) => { const jwt = ctx.response.headers.get('set-auth-jwt'); if (jwt) localStorage.setItem('auth:jwt', jwt); } } })

### デザインシステム

#### 色定義

- プライマリーカラー: ブランドカラー
- セカンダリーカラー: 補助的な情報表示
- エラーカラー: 削除やエラー表示
- サクセスカラー: 完了や成功表示
- 背景色:
  - ライトテーマ: 白ベース
  - ダークテーマ: グレー900ベース

#### スペーシング

- 基本単位: 4px
- コンポーネント内余白: 4px, 8px, 12px
- セクション間隔: 区切り線 + 8px
- ページ余白: 8px（モバイル）、16px（デスクトップ）
- 情報密度を優先し、必要最小限の余白設定

#### タイポグラフィ

- 見出し: 20px（ページタイトル）、16px（セクションタイトル）
- 本文: 14px
- 補助テキスト: 12px
- フォントファミリー: システムフォント

#### インタラクション

- ホバー効果: 不透明度0.8またはわずかな色変更
- フォーカス: 2px以上のアウトライン
- 押下時: スケール0.98のアニメーション
- トランジション: 150ms ease-in-out

## Native（Web/iOS/Android）技術仕様

### フレームワーク・ライブラリ

- React Native: Expo
- NativeWind: Tailwind CSS ライクなスタイリング
- Expo Router: ナビゲーション
- AsyncStorage: 設定の永続化
- expo-localization: デバイス言語の検出

### Native特有の実装

- 戻るボタンでドロワーを閉じる（Androidのハードウェアバックボタン対応）
- Web Share API相当の機能はexpo-sharingで実装

## 共同編集機能

### 概要

lib/crdtを使用したリアルタイム共同編集機能。タスクの並び順のみを対象とし、タスク内容の編集は通常のAPIを使用。

### 技術仕様

- **ライブラリ**: lib/crdt（CRDT実装）
- **永続化**: TaskListDocテーブル、TaskListDocOrderDocテーブル
- **同期方式**: ポーリング（5秒間隔）
- **対象**: タスクの並び順のみ

### パフォーマンス最適化

- 差分同期による通信量削減
- ローカルファーストアーキテクチャ。楽観的更新を行いUIに即座に反映

### エラーハンドリング

- 同期エラー時の自動リトライ
- オフライン時の操作継続
- 競合の自動解決（CRDT）
